{"version":3,"file":"diary-Cg9D9lWY.js","sources":["../../../../pages/patient/diary.vue"],"sourcesContent":["<template>\r\n  <div class=\"p-4\">\r\n    <h1 class=\"text-2xl font-bold mb-4\">Mój Dziennik</h1>\r\n\r\n    <div class=\"mb-4\">\r\n      <div v-if=\"todayEntry\">\r\n        <h2 class=\"text-xl font-bold\">Twój dzisiejszy wpis</h2>\r\n        <p><strong>Pozytywne wydarzenia:</strong> {{ todayEntry.positiveEvents }}</p>\r\n        <p><strong>Negatywne wydarzenia:</strong> {{ todayEntry.negativeEvents }}</p>\r\n        <div>\r\n          <h3 class=\"font-semibold\">Wpływ wydarzeń:</h3>\r\n          <ul class=\"list-disc pl-6\">\r\n            <li v-for=\"(event, index) in todayEntry.eventsImpact\" :key=\"index\">\r\n              {{ event.description }} - Ocena: {{ event.rating }}\r\n            </li>\r\n          </ul>\r\n        </div>\r\n        <button @click=\"toggleForm\" class=\"mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600\">\r\n          Edytuj wpis\r\n        </button>\r\n      </div>\r\n      <div v-else>\r\n        <p>Nie utworzyłeś jeszcze dzisiejszego wpisu.</p>\r\n        <button @click=\"toggleForm\" class=\"mt-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600\">\r\n          Utwórz wpis\r\n        </button>\r\n      </div>\r\n    </div>\r\n\r\n    <div v-if=\"showForm\" class=\"bg-white p-4 rounded shadow mb-4\">\r\n      <h2 class=\"text-xl font-bold mb-2\">{{ todayEntry ? 'Edytuj wpis' : 'Utwórz wpis' }}</h2>\r\n      <form @submit.prevent=\"submitDiary\">\r\n        <div class=\"mb-2\">\r\n          <label class=\"block text-sm font-medium text-gray-700\">Pozytywne wydarzenia</label>\r\n          <textarea v-model=\"diaryForm.positiveEvents\" required class=\"w-full border rounded p-2\"></textarea>\r\n        </div>\r\n        <div class=\"mb-2\">\r\n          <label class=\"block text-sm font-medium text-gray-700\">Negatywne wydarzenia</label>\r\n          <textarea v-model=\"diaryForm.negativeEvents\" required class=\"w-full border rounded p-2\"></textarea>\r\n        </div>\r\n        <div class=\"mb-2\">\r\n          <label class=\"block text-sm font-medium text-gray-700\">Wpływ wydarzeń na nastrój</label>\r\n          <div v-for=\"(item, index) in diaryForm.eventsImpact\" :key=\"index\" class=\"flex flex-col mb-2\">\r\n            <input v-model=\"item.description\" placeholder=\"Opis wydarzenia\" class=\"border rounded p-1 mb-1\" />\r\n            <input v-model.number=\"item.rating\" type=\"number\" min=\"1\" max=\"10\" placeholder=\"Ocena (1-10)\" class=\"border rounded p-1\" />\r\n          </div>\r\n          <button type=\"button\" @click=\"addEvent\" class=\"mt-1 text-sm text-blue-500\">Dodaj wydarzenie</button>\r\n        </div>\r\n        <button type=\"submit\" class=\"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\">\r\n          Zapisz wpis\r\n        </button>\r\n        <button type=\"button\" @click=\"cancelForm\" class=\"ml-2 px-4 py-2 bg-gray-300 text-black rounded hover:bg-gray-400\">\r\n          Anuluj\r\n        </button>\r\n      </form>\r\n      <p v-if=\"formError\" class=\"mt-2 text-red-500\">{{ formError }}</p>\r\n    </div>\r\n\r\n    <div class=\"bg-white p-4 rounded shadow\">\r\n      <h2 class=\"text-xl font-bold mb-2\">Historia wpisów</h2>\r\n      <div v-if=\"diaryHistory.length === 0\">\r\n        <p>Brak zapisów.</p>\r\n      </div>\r\n      <ul v-else class=\"space-y-4\">\r\n        <li v-for=\"entry in diaryHistory\" :key=\"entry.id\" class=\"border p-2 rounded\">\r\n          <p><strong>Data:</strong> {{ entry.date }}</p>\r\n          <p><strong>Pozytywne wydarzenia:</strong> {{ entry.positiveEvents }}</p>\r\n          <p><strong>Negatywne wydarzenia:</strong> {{ entry.negativeEvents }}</p>\r\n          <div>\r\n            <strong>Wpływ wydarzeń:</strong>\r\n            <ul class=\"list-disc pl-6\">\r\n              <li v-for=\"(ev, idx) in entry.eventsImpact\" :key=\"idx\">\r\n                {{ ev.description }} (Ocena: {{ ev.rating }})\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport axios from 'axios'\r\nimport { useLocalStorage } from '@vueuse/core'\r\n\r\ndefinePageMeta({\r\n  layout: 'patient',\r\n  middleware: 'auth',\r\n});\r\n\r\nconst diaryHistory = ref<any[]>([])\r\nconst showForm = ref(false)\r\nconst formError = ref('')\r\n\r\nconst patientId = useLocalStorage('patientId', '');\r\n\r\nconst diaryForm = ref({\r\n  patientId,\r\n  positiveEvents: '',\r\n  negativeEvents: '',\r\n  eventsImpact: [] as { description: string; rating: number }[],\r\n})\r\n\r\nasync function loadDiary() {\r\n  try {\r\n    const response = await axios.get('http://localhost:3000/diary', {\r\n      params: { patientId }\r\n    })\r\n    diaryHistory.value = response.data\r\n  } catch (error) {\r\n    console.error('Błąd podczas pobierania wpisów dziennika:', error)\r\n  }\r\n}\r\n\r\nconst todayEntry = computed(() => {\r\n  const today = new Date().toISOString().slice(0, 10)\r\n  return diaryHistory.value.find(entry => entry.date === today)\r\n})\r\n\r\nfunction addEvent() {\r\n  diaryForm.value.eventsImpact.push({ description: '', rating: 5 })\r\n}\r\n\r\nfunction toggleForm() {\r\n  showForm.value = !showForm.value\r\n  if (showForm.value && todayEntry.value) {\r\n    // Jeśli istnieje wpis dzisiejszy, wczytujemy dane do formularza\r\n    diaryForm.value = { ...todayEntry.value }\r\n  }\r\n}\r\n\r\nfunction cancelForm() {\r\n  showForm.value = false\r\n  formError.value = ''\r\n}\r\n\r\nasync function submitDiary() {\r\n  try {\r\n    let response\r\n    if (todayEntry.value) {\r\n      response = await axios.patch(`http://localhost:3000/diary/${todayEntry.value.id}`, diaryForm.value)\r\n    } else {\r\n      response = await axios.post('http://localhost:3000/diary', diaryForm.value)\r\n    }\r\n    console.log('Wpis zapisany:', response.data)\r\n    await loadDiary()\r\n    showForm.value = false\r\n  } catch (error: any) {\r\n    formError.value = error.response?.data?.message || 'Błąd podczas zapisywania wpisu'\r\n    console.error('Błąd podczas zapisywania wpisu:', error)\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await loadDiary()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;AA4FM,UAAA,eAAe,IAAW,EAAE;AAC5B,UAAA,WAAW,IAAI,KAAK;AACpB,UAAA,YAAY,IAAI,EAAE;AAElB,UAAA,YAAY,gBAAgB,aAAa,EAAE;AAEjD,UAAM,YAAY,IAAI;AAAA,MACpB;AAAA,MACA,gBAAgB;AAAA,MAChB,gBAAgB;AAAA,MAChB,cAAc,CAAA;AAAA,IAAC,CAChB;AAaK,UAAA,aAAa,SAAS,MAAM;AAC1B,YAAA,6BAAY,KAAK,GAAE,cAAc,MAAM,GAAG,EAAE;AAClD,aAAO,aAAa,MAAM,KAAK,CAAS,UAAA,MAAM,SAAS,KAAK;AAAA,IAAA,CAC7D;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}