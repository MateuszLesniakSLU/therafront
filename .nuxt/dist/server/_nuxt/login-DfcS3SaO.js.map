{"version":3,"file":"login-DfcS3SaO.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<template>\r\n  <div class=\"flex items-center justify-center min-h-screen bg-gray-100\">\r\n    <div class=\"w-full max-w-md p-8 space-y-6 bg-white shadow-md rounded\">\r\n      <h1 class=\"text-2xl font-bold text-center\">Logowanie</h1>\r\n      <form @submit.prevent=\"handleLogin\" class=\"space-y-4\">\r\n        <div>\r\n          <label for=\"email\" class=\"block text-sm font-medium text-gray-700\">Email</label>\r\n          <input\r\n              id=\"email\"\r\n              v-model=\"email\"\r\n              type=\"email\"\r\n              required\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300\"\r\n          />\r\n        </div>\r\n        <div>\r\n          <label for=\"password\" class=\"block text-sm font-medium text-gray-700\">Hasło</label>\r\n          <input\r\n              id=\"password\"\r\n              v-model=\"password\"\r\n              type=\"password\"\r\n              required\r\n              class=\"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300\"\r\n          />\r\n        </div>\r\n        <button type=\"submit\" class=\"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700\">\r\n          Zaloguj się\r\n        </button>\r\n      </form>\r\n      <p v-if=\"error\" class=\"text-center text-red-500\">{{ error }}</p>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport axios from 'axios'\r\nimport { jwtDecode } from 'jwt-decode'\r\n\r\ninterface JwtPayload {\r\n  sub: string;\r\n  role: 'doctor' | 'patient' | 'admin';\r\n  patientId?: string;\r\n}\r\n\r\nconst decodeFn = ((jwtDecode as any).default || jwtDecode) as (token: string) => JwtPayload;\r\n\r\nconst email = ref('')\r\nconst password = ref('')\r\nconst error = ref('')\r\nconst router = useRouter()\r\n\r\nasync function handleLogin() {\r\n  error.value = ''\r\n  try {\r\n    const response = await axios.post('http://localhost:3000/auth/login', {\r\n      email: email.value,\r\n      password: password.value,\r\n    })\r\n    console.log('Odpowiedź logowania:', response.data);\r\n    const token = response.data.access_token\r\n    localStorage.setItem('token', token)\r\n\r\n    const decoded = decodeFn(token)\r\n    const patientId = decoded.patientId || '';\r\n    localStorage.setItem('patientId', patientId);\r\n    console.log('Odczytany patientId:', patientId);\r\n\r\n    let targetRoute = '/'\r\n    if (decoded.role === 'doctor') {\r\n      targetRoute = '/doctor/dashboard'\r\n    } else if (decoded.role === 'patient') {\r\n      targetRoute = '/patient/dashboard'\r\n    } else if (decoded.role === 'admin') {\r\n      targetRoute = '/admin/dashboard'\r\n    }\r\n\r\n    await router.push(targetRoute)\r\n  } catch (err: any) {\r\n    error.value = err.response?.data?.message || 'Błąd logowania'\r\n    console.error('Błąd w handleLogin:', err)\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;AA8CmB,cAAkB,WAAW;AAE1C,UAAA,QAAQ,IAAI,EAAE;AACd,UAAA,WAAW,IAAI,EAAE;AACjB,UAAA,QAAQ,IAAI,EAAE;AACL,cAAU;;;;;;;;;;;;;;;;;;"}