import{u as k,r as f,c as b,a,p as I,s as E,q as w,v,t as S,z as U,o as y}from"./m7XX1WG5.js";import{a as B}from"./DW_MHI2K.js";class i extends Error{}i.prototype.name="InvalidTokenError";function C(n){return decodeURIComponent(atob(n).replace(/(.)/g,(t,o)=>{let r=o.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function D(n){let t=n.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return C(t)}catch{return atob(t)}}function h(n,t){if(typeof n!="string")throw new i("Invalid token specified: must be a string");t||(t={});const o=t.header===!0?0:1,r=n.split(".")[o];if(typeof r!="string")throw new i(`Invalid token specified: missing part #${o+1}`);let l;try{l=D(r)}catch(d){throw new i(`Invalid token specified: invalid base64 for part #${o+1} (${d.message})`)}try{return JSON.parse(l)}catch(d){throw new i(`Invalid token specified: invalid json for part #${o+1} (${d.message})`)}}const $={class:"flex items-center justify-center min-h-screen bg-gray-100"},j={class:"w-full max-w-md p-8 space-y-6 bg-white shadow-md rounded"},V={key:0,class:"text-center text-red-500"},L=k({__name:"login",setup(n){const t=h.default||h,o=f(""),r=f(""),l=f(""),d=U();async function x(){var p,e;l.value="";try{const s=await B.post("http://localhost:3000/auth/login",{email:o.value,password:r.value});console.log("Odpowiedź logowania:",s.data);const m=s.data.access_token;localStorage.setItem("token",m);const c=t(m),g=c.patientId||"";localStorage.setItem("patientId",g),console.log("Odczytany patientId:",g);let u="/";c.role==="doctor"?u="/doctor/dashboard":c.role==="patient"?u="/patient/dashboard":c.role==="admin"&&(u="/admin/dashboard"),await d.push(u)}catch(s){l.value=((e=(p=s.response)==null?void 0:p.data)==null?void 0:e.message)||"Błąd logowania",console.error("Błąd w handleLogin:",s)}}return(p,e)=>(y(),b("div",$,[a("div",j,[e[5]||(e[5]=a("h1",{class:"text-2xl font-bold text-center"},"Logowanie",-1)),a("form",{onSubmit:E(x,["prevent"]),class:"space-y-4"},[a("div",null,[e[2]||(e[2]=a("label",{for:"email",class:"block text-sm font-medium text-gray-700"},"Email",-1)),w(a("input",{id:"email","onUpdate:modelValue":e[0]||(e[0]=s=>o.value=s),type:"email",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300"},null,512),[[v,o.value]])]),a("div",null,[e[3]||(e[3]=a("label",{for:"password",class:"block text-sm font-medium text-gray-700"},"Hasło",-1)),w(a("input",{id:"password","onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),type:"password",required:"",class:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring focus:border-blue-300"},null,512),[[v,r.value]])]),e[4]||(e[4]=a("button",{type:"submit",class:"w-full py-2 px-4 bg-blue-600 text-white rounded hover:bg-blue-700"}," Zaloguj się ",-1))],32),l.value?(y(),b("p",V,S(l.value),1)):I("",!0)])]))}});export{L as default};
